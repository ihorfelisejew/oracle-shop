<div class="product-page__container" style="padding-top: 180px;">
  <nav class="breadcrumbs">
    <a href="{{ shop.url }}">Home</a>

    {% assign breadcrumbs = "" %}
    {% assign urls = "" %}
    {% assign find_collection = false %}

    {% for link in linklists.main-menu.links %}
      {% for collection in collections %}
        {% if collection.title == link.title and product.collections contains collection %}
          {% assign breadcrumbs = link.title %}
          {% assign urls = link.url %}
          {% assign find_collection = true %}
        {% endif %}
      {% endfor %}

      {% for child in link.links %}
        {% for collection in collections %}
          {% if collection.title == child.title and product.collections contains collection %}
            {% assign breadcrumbs = breadcrumbs | append: "," | append: child.title %}
            {% assign urls = urls | append: "," | append: child.url %}
          {% endif %}
        {% endfor %}

        {% for grandchild in child.links %}
          {% for collection in collections %}
            {% if collection.title == grandchild.title and product.collections contains collection %}
              {% assign breadcrumbs = breadcrumbs | append: "," | append: grandchild.title %}
              {% assign urls = urls | append: "," | append: grandchild.url %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% endfor %}

      {% if find_collection %}
        {% break %}
      {% endif %}
    {% endfor %}

    {% assign crumbs = breadcrumbs | split: "," %}
    {% assign crumb_urls = urls | split: "," %}
    {% assign last_index = crumbs.size | minus: 1 %}

    {% for crumb in crumbs %}
      <span class="separator">&gt;</span>
      {% assign index = forloop.index0 %}
      <a href="{{ crumb_urls[index] }}">{{ crumb }}</a>
    {% endfor %}

    <span class="separator">&gt;</span>
    <span class="current-page">{{ product.title }}</span>
  </nav>

  <div class="product-page__content">
    <section class="product-info__block">
      <div class="product__gallery">
        <div class="product__main-image">
          <img
            src="{{ product.featured_image | img_url: '800x' }}"
            alt="{{ product.featured_image.alt | escape }}"
            loading="lazy">
          {%- if product_item.tags contains 'New' -%}
            <span class="product__label">New</span>
          {%- endif -%}
        </div>
        {% if product.images.size > 1 %}
          <div class="product__thumbnails">
            {% for image in product.images %}
              {% unless forloop.first %}
                <div class="thumbnail__item">
                  <img
                    src="{{ image | img_url: '150x' }}"
                    alt="{{ image.alt | escape }}"
                    loading="lazy">
                </div>
              {% endunless %}
            {% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="product__info">
        <h1 class="product__title">{{ product.title }}</h1>
        {% if product.available %}
          <p class="in-stock">In Stock</p>
        {% else %}
          <p class="out-of-stock">Not In Stock</p>
        {% endif %}

        <p class="product__price">${{ product.price | money }}</p>

        <div class="product__options">
          {% if product.variants.size > 1 %}
            <label for="product-variant">Choose Size:</label>
            <select id="product-variant" name="id">
              {% for variant in product.variants %}
                <option
                  value="{{ variant.id }}"
                  {% if variant.available == false %}
                  disabled{% endif %}
                  {% if variant == product.selected_or_first_available_variant %}
                  selected{% endif %}>
                  {{ variant.title }}
                  {% if variant.available == false %}(Sold Out){% endif %}
                </option>
              {% endfor %}
            </select>
          {% else %}
            <input
              type="hidden"
              name="id"
              value="{{ product.selected_or_first_available_variant.id }}">
          {% endif %}

          <label for="quantity">Quantity:</label>
          <div class="quantity__block">
            <button class="decrease__button">-</button>
            <input
              type="number"
              id="quantity"
              name="quantity"
              value="1"
              min="1">
            <button class="increase__button">+</button>
          </div>
        </div>

        <div class="product__actions">
          <button
            type="button"
            class="add-to-cart-btn btn white-btn"
            id="add-to-cart">
            <svg
              width="20"
              height="21"
              viewBox="0 0 20 21"
              fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path
                d="M13.7729 8.30504V5.27304C13.7729 3.18904 12.0839 1.50004 10.0009 1.50004C7.91694 1.49104 6.21994 3.17204 6.21094 5.25604V5.27304V8.30504"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round" />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M14.7422 20.0004H5.25778C2.90569 20.0004 1 18.0954 1 15.7454V10.2294C1 7.87937 2.90569 5.97437 5.25778 5.97437H14.7422C17.0943 5.97437 19 7.87937 19 10.2294V15.7454C19 18.0954 17.0943 20.0004 14.7422 20.0004Z"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Add to Cart
          </button>
        </div>

        <div class="general-info__block">
          <ul class="general-info__menu">
            <li class="menu__item active" data-item="description">
              Description
            </li>
            <li class="menu__item" data-item="shipping">
              Shipping and returns
            </li>
            <li class="menu__item" data-item="packaging">
              Packaging
            </li>
          </ul>
          <div class="general-info__list">
            <div class="list__item description active">
              <p class="list-item__text">{{ product.description | strip_html }}</p>
            </div>
            <div class="list__item shipping">
              <p class="list-item__text">
                Delivery according to Nova Post rates
              </p>
            </div>
            <div class="list__item packaging">
              <p class="list-item__text">
                You can order personal packaging of parcels from us. Parcels are also actually packed at Nova Post branches.
              </p>
            </div>
          </div>
        </div>
        {% if section.settings.show_share_buttons %}
          <div class="product__share">
            <h3>Share this product</h3>
            <div class="share-buttons">
              <a href="https://www.facebook.com/" target="_blank">Facebook</a>
              <a href="https://twitter.com/" target="_blank">Twitter</a>
              <a href="https://pinterest.com/" target="_blank">Pinterest</a>
            </div>
          </div>
        {% endif %}
      </div>
    </section>
    {% if section.settings.show_related_products %}
      <section class="related-products">
        <h2>You may also like</h2>
        <div class="related-products__grid">
          {% for related_product in collections.all.products limit: 4 %}
            {% if related_product.handle != product.handle %}
              <div class="related-product__item">
                <a href="{{ related_product.url }}">
                  <img
                    src="{{ related_product.featured_image | img_url: '300x' }}"
                    alt="{{ related_product.title | escape }}"
                    loading="lazy"
                    width="300"
                    height="{{ 300 | divided_by: related_product.featured_image.aspect_ratio | round }}">
                  <h4>{{ related_product.title }}</h4>
                  <p>{{ related_product.price | money }}</p>
                </a>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </section>
    {% endif %}
  </div>


</div>

<script>
  	document.addEventListener("DOMContentLoaded", () => {
    const decreaseBtn = document.querySelector(".decrease__button");
    const increaseBtn = document.querySelector(".increase__button");
    const quantityInput = document.getElementById("quantity");

    decreaseBtn.addEventListener("click", () => {
      let currentValue = parseInt(quantityInput.value) || 1;
      if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
      }
    });

    increaseBtn.addEventListener("click", () => {
      let currentValue = parseInt(quantityInput.value) || 1;
      quantityInput.value = currentValue + 1;
    });
  });
  document.getElementById('add-to-cart').addEventListener('click', function() {
  const variantId = document.getElementById('product-variant')?.value || '{{ product.selected_or_first_available_variant.id }}';
  const quantity = document.getElementById('quantity').value;
  
  fetch('/cart/add.js', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      id: variantId,
      quantity: parseInt(quantity)
    })
  })
  .then(response => response.json())
  .then(data => {
    // Оновлення кошика
    fetch('/cart.js')
    .then(response => response.json())
    .then(cart => {
      // Тут можна оновити віджет кошика
      alert('Product added to cart!');
    });
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error adding product to cart');
  });
  });
</script>


{% schema %}
  {
    "name": "Product page",
    "tag": "section",
    "class": "section-product",
    "settings": [
      {
        "type": "checkbox",
        "id": "show_wishlist",
        "label": "Show wishlist button",
        "default": true
      }, {
        "type": "checkbox",
        "id": "show_share_buttons",
        "label": "Show share buttons",
        "default": true
      }, {
        "type": "checkbox",
        "id": "show_related_products",
        "label": "Show related products",
        "default": true
      }
    ]
  }
{% endschema %}