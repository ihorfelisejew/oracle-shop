<div class="product-page__container" style="padding-top: 180px;">
  <nav class="breadcrumbs">
    <a href="{{ shop.url }}">Home</a>

    {% assign breadcrumbs = "" %}
    {% assign urls = "" %}
    {% assign find_collection = false %}

    {% for link in linklists.main-menu.links %}
      {% for collection in collections %}
        {% if collection.title == link.title and product.collections contains collection %}
          {% assign breadcrumbs = link.title %}
          {% assign urls = link.url %}
          {% assign find_collection = true %}
        {% endif %}
      {% endfor %}

      {% for child in link.links %}
        {% for collection in collections %}
          {% if collection.title == child.title and product.collections contains collection %}
            {% assign breadcrumbs = breadcrumbs | append: "," | append: child.title %}
            {% assign urls = urls | append: "," | append: child.url %}
          {% endif %}
        {% endfor %}

        {% for grandchild in child.links %}
          {% for collection in collections %}
            {% if collection.title == grandchild.title and product.collections contains collection %}
              {% assign breadcrumbs = breadcrumbs | append: "," | append: grandchild.title %}
              {% assign urls = urls | append: "," | append: grandchild.url %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% endfor %}

      {% if find_collection %}
        {% break %}
      {% endif %}
    {% endfor %}

    {% assign crumbs = breadcrumbs | split: "," %}
    {% assign crumb_urls = urls | split: "," %}
    {% assign last_index = crumbs.size | minus: 1 %}

    {% for crumb in crumbs %}
      <span class="separator">&gt;</span>
      {% assign index = forloop.index0 %}
      <a href="{{ crumb_urls[index] }}">{{ crumb }}</a>
    {% endfor %}

    <span class="separator">&gt;</span>
    <span class="current-page">{{ product.title }}</span>
  </nav>

  <div class="product-page__content">
    <section class="product-info__block">
      <div class="product__gallery">
        <div class="product__main-image">
          <img
            src="{{ product.featured_image | img_url: '800x' }}"
            alt="{{ product.featured_image.alt | escape }}"
            loading="lazy">
          {%- if product_item.tags contains 'New' -%}
            <span class="product__label">New</span>
          {%- endif -%}
        </div>
        {% if product.images.size > 1 %}
          <div class="product__thumbnails">
            {% for image in product.images %}
              {% unless forloop.first %}
                <div class="thumbnail__item">
                  <img
                    src="{{ image | img_url: '150x' }}"
                    alt="{{ image.alt | escape }}"
                    loading="lazy">
                </div>
              {% endunless %}
            {% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="product__info">
        <h1 class="product__title">{{ product.title }}</h1>
        {% if product.available %}
          <p class="in-stock">In Stock</p>
        {% else %}
          <p class="out-of-stock">Not In Stock</p>
        {% endif %}

        <p class="product__price">{{ product.price | money }}</p>

        <div class="product__options">
          {% if product.variants.size > 1 %}
            <label for="product-variant">Choose Size:</label>
            <select id="product-variant" name="id">
              {% for variant in product.variants %}
                <option
                  value="{{ variant.id }}"
                  {% if variant.available == false %}
                  disabled{% endif %}
                  {% if variant == product.selected_or_first_available_variant %}
                  selected{% endif %}>
                  {{ variant.title }}
                  {% if variant.available == false %}(Sold Out){% endif %}
                </option>
              {% endfor %}
            </select>
          {% else %}
            <input
              type="hidden"
              name="id"
              value="{{ product.selected_or_first_available_variant.id }}">
          {% endif %}

          <label for="quantity">Quantity:</label>
          <div class="quantity__block">
            <button class="decrease__button">-</button>
            <input
              type="number"
              id="quantity"
              name="quantity"
              value="1"
              min="1">
            <button class="increase__button">+</button>
          </div>
        </div>

        <div class="product__actions">
          <button
            type="button"
            class="add-to-cart-btn btn white-btn"
            id="add-to-cart">
            <svg
              width="20"
              height="21"
              viewBox="0 0 20 21"
              fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <path
                d="M13.7729 8.30504V5.27304C13.7729 3.18904 12.0839 1.50004 10.0009 1.50004C7.91694 1.49104 6.21994 3.17204 6.21094 5.25604V5.27304V8.30504"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round" />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M14.7422 20.0004H5.25778C2.90569 20.0004 1 18.0954 1 15.7454V10.2294C1 7.87937 2.90569 5.97437 5.25778 5.97437H14.7422C17.0943 5.97437 19 7.87937 19 10.2294V15.7454C19 18.0954 17.0943 20.0004 14.7422 20.0004Z"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
            Add to Cart
          </button>
        </div>

        <div class="general-info__block">
          <ul class="general-info__menu">
            <li class="menu__item active" data-item="description">
              Description
            </li>
            <li class="menu__item" data-item="shipping">
              Shipping and returns
            </li>
            <li class="menu__item" data-item="packaging">
              Packaging
            </li>
          </ul>
          <div class="general-info__list">
            <div class="list__item description active">
              <p class="list-item__text">{{ product.description | strip_html }}</p>
            </div>
            <div class="list__item shipping">
              <p class="list-item__text">
                Delivery according to Nova Post rates
              </p>
            </div>
            <div class="list__item packaging">
              <p class="list-item__text">
                You can order personal packaging of parcels from us. Parcels are also actually packed at Nova Post branches.
              </p>
            </div>
          </div>
        </div>
        <div class="pickup__info">
          <svg
            width="18"
            height="22"
            viewBox="0 0 18 22"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M15.2803 8.21967C15.5732 8.51256 15.5732 8.98744 15.2803 9.28033L7.28033 17.2803C6.98744 17.5732 6.51256 17.5732 6.21967 17.2803L2.21967 13.2803C1.92678 12.9874 1.92678 12.5126 2.21967 12.2197C2.51256 11.9268 2.98744 11.9268 3.28033 12.2197L6.75 15.6893L14.2197 8.21967C14.5126 7.92678 14.9874 7.92678 15.2803 8.21967Z"
              fill="#17B656" />
          </svg>
          <div class="pickup__info-texts">
            <p class="main-text">
              Pickup available at
              <span>Oracle Store</span>
              (LitwoodRock Street 155, Chicago)
            </p>
            <p class="note">
              Usually ready in 24 hours
            </p>
          </div>
        </div>
        {% if section.settings.show_share_buttons %}
          <div class="product__share">
            <p>Share:</p>
            <div class="share-buttons">
              {% if settings.social_facebook_link != blank %}
                <a
                  href="{{ settings.social_facebook_link }}"
                  target="_blank"
                  rel="noopener">
                  <svg
                    width="10"
                    height="18"
                    viewBox="0 0 10 18"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.5 3H6.5C5.94772 3 5.5 3.44772 5.5 4V7H9.5C9.61374 6.99748 9.7216 7.05039 9.78923 7.14188C9.85685 7.23336 9.87578 7.35201 9.84 7.46L9.1 9.66C9.03181 9.86192 8.84312 9.99842 8.63 10H5.5V17.5C5.5 17.7761 5.27614 18 5 18H2.5C2.22386 18 2 17.7761 2 17.5V10H0.5C0.223858 10 0 9.77614 0 9.5V7.5C0 7.22386 0.223858 7 0.5 7H2V4C2 1.79086 3.79086 0 6 0H9.5C9.77614 0 10 0.223858 10 0.5V2.5C10 2.77614 9.77614 3 9.5 3Z" fill="black" />
                  </svg>
                </a>
              {% endif %}
              {% if settings.social_twitter_link != blank %}
                <a
                  href="{{ settings.social_twitter_link }}"
                  target="_blank"
                  rel="noopener">
                  <svg
                    width="20"
                    height="18"
                    viewBox="0 0 20 18"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.9708 2.96378C19.4547 3.65213 18.8309 4.25258 18.1235 4.74195C18.1235 4.92177 18.1235 5.10158 18.1235 5.29139C18.1292 8.5568 16.8249 11.6879 14.5029 13.9828C12.181 16.2777 9.03567 17.5443 5.77211 17.4988C3.88538 17.5051 2.02281 17.0743 0.330301 16.2401C0.239042 16.2003 0.18018 16.11 0.180527 16.0103V15.9005C0.180527 15.757 0.296758 15.6407 0.440136 15.6407C2.29475 15.5796 4.0832 14.9366 5.55244 13.8026C3.87376 13.7688 2.36338 12.7744 1.66829 11.2453C1.63318 11.1617 1.64411 11.0659 1.69713 10.9925C1.75016 10.919 1.83761 10.8785 1.9279 10.8856C2.43809 10.9369 2.95337 10.8894 3.44561 10.7458C1.59249 10.3611 0.200074 8.82265 0.000797149 6.93969C-0.00628542 6.84936 0.0341943 6.76187 0.107613 6.70882C0.181031 6.65577 0.276775 6.64483 0.360256 6.67996C0.857554 6.89939 1.39439 7.01496 1.93788 7.01961C0.314106 5.95384 -0.387258 3.92672 0.230452 2.08469C0.294214 1.9057 0.447402 1.77347 0.633723 1.7366C0.820043 1.69972 1.01201 1.76365 1.13908 1.90487C3.33027 4.23695 6.34099 5.62662 9.53645 5.78088C9.4546 5.45427 9.41434 5.11862 9.41663 4.78191C9.44652 3.01636 10.5389 1.44357 12.1825 0.799861C13.826 0.156154 15.6953 0.568927 16.9153 1.84494C17.747 1.68651 18.551 1.40716 19.3018 1.01579C19.3568 0.981454 19.4265 0.981454 19.4815 1.01579C19.5158 1.07081 19.5158 1.14058 19.4815 1.1956C19.1178 2.02835 18.5035 2.7268 17.7241 3.19355C18.4066 3.1144 19.0771 2.95341 19.7211 2.71404C19.7754 2.67713 19.8466 2.67713 19.9009 2.71404C19.9463 2.73482 19.9802 2.77457 19.9937 2.82269C20.0072 2.87081 19.9988 2.92242 19.9708 2.96378Z" fill="black" />
                  </svg>
                </a>
              {% endif %}
              {% if settings.social_pinterest_link != blank %}
                <a
                  href="{{ settings.social_pinterest_link }}"
                  target="_blank"
                  rel="noopener">
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M10.0616 0C4.52772 0 0 4.61538 0 10.2564C0 14.4872 2.51541 18.0769 6.03697 19.6154C6.03697 18.8462 6.03696 18.0769 6.16273 17.3077C6.41427 16.4103 7.42043 11.6667 7.42043 11.6667C7.42043 11.6667 7.04313 11.0256 7.04313 10C7.04313 8.46154 7.92352 7.30769 8.92969 7.30769C9.81008 7.30769 10.3131 7.94872 10.3131 8.84615C10.3131 9.74359 9.6843 11.1538 9.43276 12.4359C9.18122 13.4615 9.93584 14.359 11.0678 14.359C12.9543 14.359 14.212 11.9231 14.212 8.84615C14.212 6.53846 12.7028 4.87179 10.0616 4.87179C7.04313 4.87179 5.15658 7.17949 5.15658 9.74359C5.15658 10.641 5.40812 11.2821 5.78543 11.7949C5.9112 12.0513 6.03696 12.0513 5.91119 12.3077C5.91119 12.4359 5.78543 12.9487 5.65966 13.0769C5.53389 13.3333 5.40812 13.4615 5.15658 13.3333C3.77311 12.6923 3.14425 11.1538 3.14425 9.35897C3.14425 6.41026 5.53388 2.94872 10.3131 2.94872C14.212 2.94872 16.7274 5.76923 16.7274 8.84615C16.7274 12.8205 14.5893 15.8974 11.3193 15.8974C10.1874 15.8974 9.18122 15.2564 8.80391 14.6154C8.80391 14.6154 8.17505 16.9231 8.04928 17.4359C7.79774 18.2051 7.42044 18.9744 7.04313 19.6154C7.92352 19.8718 8.92967 20 9.93583 20C15.4697 20 19.9974 15.3846 19.9974 9.74359C20.1232 4.61539 15.5955 0 10.0616 0Z" fill="black" />
                  </svg>
                </a>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </section>
    {% if section.settings.show_related_products %}
      <section class="related-products">
        <h2 class="related-products__title title">You may also like</h2>
        <div class="related-products__list">
          {% for related_product in collections.all.products limit: 4 %}
            {% if related_product.handle != product.handle %}
              <div class="related-product__item">
                <a href="{{ related_product.url }}" class="image__block">
                  {%- if related_product.tags contains 'New' -%}
                    <span class="product__label">New</span>
                  {%- endif -%}
                  <img
                    src="{{ related_product.featured_image | img_url: '300x' }}"
                    alt="{{ related_product.title | escape }}"
                    loading="lazy"
                    width="300"
                    height="{{ 300 | divided_by: related_product.featured_image.aspect_ratio | round }}">
                  <span class="view-more">View More</span>
                </a>
                <a href="{{ related_product.url }}" class="product__name">{{ related_product.title }}</a>
                <p class="product__price">
                  {{ related_product.price | money }}
                  {%- if related_product.compare_at_price > related_product.price -%}
                    <span class="old-price">{{ related_product.compare_at_price | money }}</span>
                  {%- endif -%}
                </p>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </section>
    {% endif %}
  </div>
</div>

<script>
  	document.addEventListener("DOMContentLoaded", () => {
    const decreaseBtn = document.querySelector(".decrease__button");
    const increaseBtn = document.querySelector(".increase__button");
    const quantityInput = document.getElementById("quantity");

    decreaseBtn.addEventListener("click", () => {
      let currentValue = parseInt(quantityInput.value) || 1;
      if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
      }
    });

    increaseBtn.addEventListener("click", () => {
      let currentValue = parseInt(quantityInput.value) || 1;
      quantityInput.value = currentValue + 1;
    });
  });
  document.getElementById('add-to-cart').addEventListener('click', function() {
  const variantId = document.getElementById('product-variant')?.value || '{{ product.selected_or_first_available_variant.id }}';
  const quantity = document.getElementById('quantity').value;
  
  fetch('/cart/add.js', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      id: variantId,
      quantity: parseInt(quantity)
    })
  })
  .then(response => response.json())
  .then(data => {
    // Оновлення кошика
    fetch('/cart.js')
    .then(response => response.json())
    .then(cart => {
      // Тут можна оновити віджет кошика
      alert('Product added to cart!');
    });
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error adding product to cart');
  });
  });
</script>


{% schema %}
  {
    "name": "Product page",
    "tag": "section",
    "class": "section-product",
    "settings": [
      {
        "type": "checkbox",
        "id": "show_wishlist",
        "label": "Show wishlist button",
        "default": true
      }, {
        "type": "checkbox",
        "id": "show_share_buttons",
        "label": "Show share buttons",
        "default": true
      }, {
        "type": "checkbox",
        "id": "show_related_products",
        "label": "Show related products",
        "default": true
      }
    ]
  }
{% endschema %}